<?xml version='1.0' encoding='utf-8'?>
<!--
Copyright (c) 2024, QIIME 2 development team.

Distributed under the terms of the Modified BSD License. (SPDX: BSD-3-Clause)
-->
<!--
This tool was automatically generated by:
    q2galaxy (version: 2024.10.0)
for:
    qiime2 (version: 2024.10.1)
-->
<tool name="qiime2 composition ancombc" id="qiime2__composition__ancombc" version="2024.10.0+q2galaxy.2024.10.0" profile="22.05" license="BSD-3-Clause">
    <description>Analysis of Composition of Microbiomes with Bias Correction</description>
    <xrefs>
        <xref type="bio.tools">qiime2</xref>
    </xrefs>
    <edam_topics>
        <edam_topic>topic_3174</edam_topic>
    </edam_topics>
    <requirements>
        <container type="docker">quay.io/qiime2/amplicon:2024.10</container>
    </requirements>
    <version_command>q2galaxy version composition</version_command>
    <command detect_errors="exit_code">q2galaxy run composition ancombc '$inputs'</command>
    <configfiles>
        <inputs name="inputs" data_style="staging_path_and_source_path"/>
    </configfiles>
    <inputs>
        <param name="table" type="data" format="qza" label="table: FeatureTable[Frequency]" help="[required]  The feature table to be used for ANCOM-BC computation.">
            <options options_filter_attribute="metadata.semantic_type">
                <filter type="add_value" value="FeatureTable[Frequency]"/>
            </options>
            <validator type="expression" message="Incompatible type">hasattr(value.metadata, "semantic_type") and value.metadata.semantic_type in ['FeatureTable[Frequency]']</validator>
        </param>
        <repeat name="metadata" min="1" help="[required]  The sample metadata." title="metadata: Metadata">
            <conditional name="__q2galaxy__GUI__conditional__metadata__">
                <param name="type" type="select" label="metadata: Metadata">
                    <option value="tsv" selected="true">Metadata from TSV</option>
                    <option value="qza">Metadata from Artifact</option>
                </param>
                <when value="tsv">
                    <param name="source" type="data" format="tabular,qiime2.tabular" label="Metadata Source"/>
                </when>
                <when value="qza">
                    <param name="source" type="data" format="qza" label="Metadata Source"/>
                </when>
            </conditional>
        </repeat>
        <param name="formula" type="text" label="formula: Str" help="[required]  How the microbial absolute abundances for each taxon depend on the variables within the `metadata`.">
            <sanitizer>
                <valid initial="string.printable"/>
            </sanitizer>
            <validator type="expression" message="Please verify this parameter.">value is not None and len(value) &gt; 0</validator>
        </param>
        <section name="__q2galaxy__GUI__section__extra_opts__" title="Click here for additional options">
            <param name="p_adj_method" type="select" label="p_adj_method: Str % Choices('holm', 'hochberg', 'hommel', 'bonferroni', 'BH', 'BY', 'fdr', 'none')">
                <option value="holm" selected="true">holm</option>
                <option value="hochberg">hochberg</option>
                <option value="hommel">hommel</option>
                <option value="bonferroni">bonferroni</option>
                <option value="BH">BH</option>
                <option value="BY">BY</option>
                <option value="fdr">fdr</option>
                <option value="none">none</option>
            </param>
            <param name="prv_cut" type="float" value="0.1" label="prv_cut: Float" help="[default: 0.1]  A numerical fraction between 0-1. Taxa with prevalences less than this value will be excluded from the analysis."/>
            <param name="lib_cut" type="integer" value="0" label="lib_cut: Int" help="[default: 0]  A numerical threshold for filtering samples based on library sizes. Samples with library sizes less than this value will be excluded from the analysis."/>
            <repeat name="reference_levels" help="[optional]  Define the reference level(s) to be used for categorical columns found in the `formula`. These categorical factors are dummy coded relative to the reference(s) provided. The syntax is as follows: &quot;column_name::column_value&quot;" title="reference_levels: List[Str]">
                <param name="element" type="text" label="element: Str" help="[required]">
                    <sanitizer>
                        <valid initial="string.printable"/>
                    </sanitizer>
                    <validator type="expression" message="Please verify this parameter.">value is not None and len(value) &gt; 0</validator>
                </param>
            </repeat>
            <param name="tol" type="float" value="1e-05" label="tol: Float" help="[default: 1e-05]  The iteration convergence tolerance for the E-M algorithm."/>
            <param name="max_iter" type="integer" value="100" label="max_iter: Int" help="[default: 100]  The maximum number of iterations for the E-M algorithm."/>
            <param name="conserve" type="boolean" truevalue="__q2galaxy__::literal::True" falsevalue="__q2galaxy__::literal::False" label="conserve: Bool" help="[default: No]  Whether to use a conservative variance estimator for the test statistic. It is recommended if the sample size is small and/or the number of differentially abundant taxa is believed to be large."/>
            <param name="alpha" type="float" value="0.05" label="alpha: Float" help="[default: 0.05]  Level of significance."/>
        </section>
    </inputs>
    <outputs>
        <data name="differentials" format="qza" label="${tool.name} on ${on_string}: differentials.qza" from_work_dir="differentials.qza"/>
    </outputs>
    <tests>
        <test>
            <param name="table" value="ancombc.test0.table.qza" ftype="qza"/>
            <repeat name="metadata">
                <conditional name="__q2galaxy__GUI__conditional__metadata__">
                    <param name="type" value="tsv"/>
                    <param name="source" value="ancombc.test0.metadata.tsv" ftype="qiime2.tabular"/>
                </conditional>
            </repeat>
            <param name="formula" value="bodysite"/>
            <output name="differentials" ftype="qza">
                <assert_contents>
                    <has_archive_member path="[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}\/metadata.yaml">
                        <has_line_matching expression="type: FeatureData\[DifferentialAbundance\]"/>
                    </has_archive_member>
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="table" value="ancombc.test1.table.qza" ftype="qza"/>
            <repeat name="metadata">
                <conditional name="__q2galaxy__GUI__conditional__metadata__">
                    <param name="type" value="tsv"/>
                    <param name="source" value="ancombc.test1.metadata.tsv" ftype="qiime2.tabular"/>
                </conditional>
            </repeat>
            <param name="formula" value="bodysite + animal"/>
            <repeat name="reference_levels">
                <param name="element" value="bodysite::tongue"/>
            </repeat>
            <repeat name="reference_levels">
                <param name="element" value="animal::dog"/>
            </repeat>
            <output name="differentials" ftype="qza">
                <assert_contents>
                    <has_archive_member path="[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}\/metadata.yaml">
                        <has_line_matching expression="type: FeatureData\[DifferentialAbundance\]"/>
                    </has_archive_member>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help>
QIIME 2: composition ancombc
============================
Analysis of Composition of Microbiomes with Bias Correction


Outputs:
--------
:differentials.qza: The calculated per-feature differentials.

|  

Description:
------------
Apply Analysis of Compositions of Microbiomes with Bias Correction (ANCOM-BC) to identify features that are differentially abundant across groups.

Examples:
---------

ancombc_single_formula
**********************
Using the ``qiime2 composition ancombc`` tool:
 #. Set *"table"* to ``#: table.qza``
 #. For *"metadata"*:

    - Perform the following steps.

      #. Leave as ``Metadata from TSV``
      #. Set *"Metadata Source"* to ``metadata.tsv``


 #. Set *"formula"* to ``bodysite``
 #. Press the ``Execute`` button.

Once completed, for the new entry in your history, use the ``Edit`` button to set the name as follows:
 (Renaming is optional, but it will make any subsequent steps easier to complete.)

 .. list-table::
    :align: left
    :header-rows: 1

    * - History Name
      - *"Name"* to set (be sure to press ``Save``)
    * - ``#: qiime2 composition ancombc [...] : differentials.qza``
      - ``dataloaf.qza``

ancombc_multi_formula_with_reference_levels
*******************************************
Using the ``qiime2 composition ancombc`` tool:
 #. Set *"table"* to ``#: table.qza``
 #. For *"metadata"*:

    - Perform the following steps.

      #. Leave as ``Metadata from TSV``
      #. Set *"Metadata Source"* to ``metadata.tsv``


 #. Set *"formula"* to ``bodysite + animal``
 #. Expand the ``additional options`` section

    - For *"reference_levels"*, use the ``+ reference_levels`` button to add the corresponding values:

      #. Add *"element"* set to ``bodysite::tongue``
      #. Add *"element"* set to ``animal::dog``


 #. Press the ``Execute`` button.

Once completed, for the new entry in your history, use the ``Edit`` button to set the name as follows:
 (Renaming is optional, but it will make any subsequent steps easier to complete.)

 .. list-table::
    :align: left
    :header-rows: 1

    * - History Name
      - *"Name"* to set (be sure to press ``Save``)
    * - ``#: qiime2 composition ancombc [...] : differentials.qza``
      - ``dataloaf.qza``


|  

</help>
    <citations>
        <citation type="doi">10.1038/s41467-020-17041-7</citation>
        <citation type="doi">10.1038/s41587-019-0209-9</citation>
    </citations>
</tool>
