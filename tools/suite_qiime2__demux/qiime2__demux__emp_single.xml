<?xml version='1.0' encoding='utf-8'?>
<!--
Copyright (c) 2023, QIIME 2 development team.

Distributed under the terms of the Modified BSD License. (SPDX: BSD-3-Clause)
-->
<!--
This tool was automatically generated by:
    q2galaxy (version: 2022.11.1)
for:
    qiime2 (version: 2022.11.1)
-->
<tool name="qiime2 demux emp-single" id="qiime2__demux__emp_single" version="2022.11.1+q2galaxy.2022.11.1.2" profile="22.05" license="BSD-3-Clause">
    <description>Demultiplex sequence data generated with the EMP protocol.</description>
    <requirements>
        <container type="docker">quay.io/qiime2/core:2022.11</container>
    </requirements>
    <version_command>q2galaxy version demux</version_command>
    <command detect_errors="exit_code">q2galaxy run demux emp_single '$inputs'</command>
    <configfiles>
        <inputs name="inputs" data_style="paths"/>
    </configfiles>
    <inputs>
        <param name="seqs" type="data" format="qza" label="seqs: RawSequences | EMPSingleEndSequences | EMPPairedEndSequences" help="[required]  The single-end sequences to be demultiplexed.">
            <options options_filter_attribute="metadata.semantic_type">
                <filter type="add_value" value="RawSequences"/>
                <filter type="add_value" value="EMPSingleEndSequences"/>
                <filter type="add_value" value="EMPPairedEndSequences"/>
            </options>
            <validator type="expression" message="Incompatible type">hasattr(value.metadata, "semantic_type") and value.metadata.semantic_type in ['EMPPairedEndSequences', 'EMPSingleEndSequences', 'RawSequences']</validator>
        </param>
        <conditional name="barcodes">
            <param name="type" type="select" label="barcodes: MetadataColumn[Categorical]" help="[required]  The sample metadata column containing the per-sample barcodes.">
                <option value="tsv" selected="true">Metadata from TSV</option>
                <option value="qza">Metadata from Artifact</option>
            </param>
            <when value="tsv">
                <param name="source" type="data" format="tabular,qiime2.tabular" label="Metadata Source"/>
                <param name="column" type="data_column" label="Column Name" data_ref="source" use_header_names="true">
                    <validator type="expression" message="The first column cannot be selected (they are IDs).">value != "1"</validator>
                </param>
            </when>
            <when value="qza">
                <param name="source" type="data" format="qza" label="Metadata Source"/>
                <param name="column" type="text" label="Column Name">
                    <validator type="empty_field"/>
                </param>
            </when>
        </conditional>
        <section name="__q2galaxy__GUI__section__extra_opts__" title="Click here for additional options">
            <param name="golay_error_correction" type="boolean" truevalue="__q2galaxy__::literal::True" falsevalue="__q2galaxy__::literal::False" checked="true" label="golay_error_correction: Bool" help="[default: Yes]  Perform 12nt Golay error correction on the barcode reads."/>
            <param name="rev_comp_barcodes" type="boolean" truevalue="__q2galaxy__::literal::True" falsevalue="__q2galaxy__::literal::False" label="rev_comp_barcodes: Bool" help="[default: No]  If provided, the barcode sequence reads will be reverse complemented prior to demultiplexing."/>
            <param name="rev_comp_mapping_barcodes" type="boolean" truevalue="__q2galaxy__::literal::True" falsevalue="__q2galaxy__::literal::False" label="rev_comp_mapping_barcodes: Bool" help="[default: No]  If provided, the barcode sequences in the sample metadata will be reverse complemented prior to demultiplexing."/>
            <param name="ignore_description_mismatch" type="boolean" truevalue="__q2galaxy__::literal::True" falsevalue="__q2galaxy__::literal::False" label="ignore_description_mismatch: Bool" help="[default: No]  If enabled, ignore mismatches in sequence record description fields."/>
        </section>
    </inputs>
    <outputs>
        <data name="per_sample_sequences" format="qza" label="${tool.name} on ${on_string}: per_sample_sequences.qza" from_work_dir="per_sample_sequences.qza"/>
        <data name="error_correction_details" format="qza" label="${tool.name} on ${on_string}: error_correction_details.qza" from_work_dir="error_correction_details.qza"/>
    </outputs>
    <tests>
        <test>
            <param name="seqs" value="emp_single.test0.sequences.qza" ftype="qza"/>
            <conditional name="barcodes">
                <param name="type" value="tsv"/>
                <param name="source" value="emp_single.test0.sample-metadata.tsv" ftype="qiime2.tabular"/>
                <param name="column" value="2"/>
            </conditional>
            <output name="per_sample_sequences" ftype="qza">
                <assert_contents>
                    <has_archive_member path="[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}\/metadata.yaml">
                        <has_line_matching expression="type: SampleData\[SequencesWithQuality\]"/>
                    </has_archive_member>
                </assert_contents>
            </output>
            <output name="error_correction_details" ftype="qza">
                <assert_contents>
                    <has_archive_member path="[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}\/metadata.yaml">
                        <has_line_matching expression="type: ErrorCorrectionDetails"/>
                    </has_archive_member>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help>
QIIME 2: demux emp-single
=========================
Demultiplex sequence data generated with the EMP protocol.


Outputs:
--------
:per_sample_sequences.qza: The resulting demultiplexed sequences.
:error_correction_details.qza: Detail about the barcode error corrections.

|  

Description:
------------
Demultiplex sequence data (i.e., map barcode reads to sample ids) for data generated with the Earth Microbiome Project (EMP) amplicon sequencing protocol. Details about this protocol can be found at http://www.earthmicrobiome.org/protocols-and-standards/

Examples:
---------

demux
*****
Using the ``qiime2 demux emp-single`` tool:
 #. Set *"seqs"* to ``#: sequences.qza``
 #. For *"barcodes"*:

    #. Leave as ``Metadata from TSV``
    #. Set *"Metadata Source"* to ``sample-metadata.tsv``
    #. Set *"Column Name"* to ``barcode-sequence``

 #. Press the ``Execute`` button.

Once completed, for each new entry in your history, use the ``Edit`` button to set the name as follows:
 (Renaming is optional, but it will make any subsequent steps easier to complete.)

 .. list-table::
    :align: left
    :header-rows: 1

    * - History Name
      - *"Name"* to set (be sure to press ``Save``)
    * - ``#: qiime2 demux emp-single [...] : per_sample_sequences.qza``
      - ``demux.qza``
    * - ``#: qiime2 demux emp-single [...] : error_correction_details.qza``
      - ``demux-details.qza``


|  

</help>
    <citations>
        <citation type="doi">10.1038/nmeth.1184</citation>
        <citation type="doi">10.1101/gr.085464.108</citation>
        <citation type="doi">10.1038/s41587-019-0209-9</citation>
    </citations>
</tool>
